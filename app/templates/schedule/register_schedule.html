{% extends "base3.html" %} {% block title %}Âõ∫ÂÆö„Çø„Çπ„ÇØÁôªÈå≤{% endblock %}
<style>
  /* Fixed Task Registration Form - Complete CSS Replication */

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family:
      -apple-system, BlinkMacSystemFont, "Segoe UI", "Hiragino Sans",
      "Hiragino Kaku Gothic ProN", "Yu Gothic", YuGothic, Meiryo, sans-serif;
    background-color: #f5f5f5;
    padding-bottom: 100px;
  }

  /* Header Styles */
  .header {
    background-color: #fff;
    padding: 20px 16px 0;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  }

  .header h1 {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 20px;
    color: #333;
    text-align: center;
  }

  /* Tab Container */
  .tab-container {
    display: flex;
    gap: 8px;
    margin-bottom: 0;
    padding: 0 8px;
  }

  .tab {
    flex: 1;
    padding: 10px 20px;
    background: transparent;
    border: none;
    border-bottom: 3px solid transparent;
    font-size: 14px;
    color: #999;
    cursor: pointer;
    transition: all 0.2s;
    font-weight: 500;
  }

  .tab.active {
    color: #ff9f5a;
    border-bottom-color: #ff9f5a;
  }

  /* Form Container */
  .form-container {
    padding: 20px 16px;
  }

  /* Form Section */
  .form-section {
    margin-bottom: 24px;
  }

  /* Form Label */
  .form-label {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    color: #ffb380;
    font-size: 14px;
    font-weight: 500;
  }

  .template-link {
    color: #ff9f5a;
    text-decoration: none;
    font-size: 13px;
    display: flex;
    align-items: center;
    gap: 4px;
    transition: opacity 0.2s;
  }

  .template-link:hover {
    opacity: 0.7;
  }

  /* Form Input */
  .form-input {
    width: 100%;
    padding: 16px;
    border: 1px solid #e0e0e0;
    border-radius: 12px;
    font-size: 15px;
    background: #fff;
    color: #333;
    font-family: inherit;
    transition: all 0.2s;
  }

  .form-input::placeholder {
    color: #ccc;
  }

  .form-input:focus {
    outline: none;
    border-color: #ff9f5a;
    box-shadow: 0 0 0 3px rgba(255, 159, 90, 0.1);
  }

  /* Time Inputs */
  .time-inputs {
    display: flex;
    gap: 12px;
  }

  .time-input-wrapper {
    flex: 1;
    position: relative;
  }

  .time-label {
    display: block;
    color: #999;
    font-size: 13px;
    margin-bottom: 8px;
  }

  .time-input {
    width: 100%;
    padding: 14px 40px 14px 16px;
    border: 1px solid #e0e0e0;
    border-radius: 12px;
    font-size: 15px;
    background: #fff;
    color: #999;
    font-family: inherit;
    transition: all 0.2s;
    appearance: none;
    -webkit-appearance: none;
  }

  .time-input:focus {
    outline: none;
    border-color: #ff9f5a;
    box-shadow: 0 0 0 3px rgba(255, 159, 90, 0.1);
    color: #333;
  }

  .time-icon {
    position: absolute;
    right: 14px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 18px;
    pointer-events: none;
    margin-top: 12px; /* Adjust for label */
  }

  /* Weekday Selector */
  .weekday-selector {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .weekday-btn {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    border: none;
    font-size: 15px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    background: #e8e8e8;
    color: #999;
    font-family: inherit;
  }

  .weekday-btn.active {
    background: #ff9f5a;
    color: #fff;
    transform: scale(1.05);
  }

  .weekday-btn:hover {
    transform: scale(1.08);
  }

  .weekday-btn:active {
    transform: scale(0.95);
  }

  /* Category Selector */
  .category-selector {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }

  .category-btn {
    padding: 12px 24px;
    border-radius: 20px;
    border: 1px solid #e0e0e0;
    background: #fff;
    color: #999;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    font-family: inherit;
  }

  .category-btn.active {
    background: #ff9f5a;
    color: #fff;
    border-color: #ff9f5a;
  }

  .category-btn:hover {
    border-color: #ff9f5a;
    color: #ff9f5a;
  }

  .category-btn.active:hover {
    color: #fff;
  }

  /* Memo Textarea */
  .memo-textarea {
    width: 100%;
    min-height: 150px;
    padding: 16px;
    border: 1px solid #e0e0e0;
    border-radius: 12px;
    font-size: 14px;
    background: #f8f9fa;
    color: #333;
    font-family: inherit;
    resize: vertical;
    transition: all 0.2s;
    line-height: 1.6;
  }

  .memo-textarea::placeholder {
    color: #ccc;
  }

  .memo-textarea:focus {
    outline: none;
    border-color: #ff9f5a;
    box-shadow: 0 0 0 3px rgba(255, 159, 90, 0.1);
    background: #fff;
  }

  /* Info Box */
  .info-box {
    display: flex;
    gap: 12px;
    align-items: flex-start;
    padding: 16px;
    background: #fff8f3;
    border-radius: 12px;
    margin-top: 24px;
    border: 1px solid #ffe5d6;
  }

  .info-icon {
    font-size: 28px;
    flex-shrink: 0;
  }

  .info-text {
    color: #666;
    font-size: 13px;
    line-height: 1.6;
    margin: 4px 0 0 0;
  }

  /* Submit Button */
  .submit-btn {
    position: fixed;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    width: calc(100% - 32px);
    max-width: 400px;
    padding: 16px;
    background: linear-gradient(135deg, #ffb380 0%, #ff9f5a 100%);
    color: #fff;
    border: none;
    border-radius: 28px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(255, 159, 90, 0.3);
    transition: all 0.2s;
    font-family: inherit;
  }

  .submit-btn:hover {
    transform: translateX(-50%) translateY(-2px);
    box-shadow: 0 6px 16px rgba(255, 159, 90, 0.4);
  }

  .submit-btn:active {
    transform: translateX(-50%) translateY(0);
  }

  .submit-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
    box-shadow: none;
  }

  /* Bottom Navigation */
  .bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: #fff;
    display: flex;
    justify-content: space-around;
    padding: 8px 0 12px;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
    z-index: 1000;
  }

  .nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    text-decoration: none;
    color: #999;
    font-size: 11px;
    flex: 1;
    padding: 4px;
    transition: color 0.2s;
  }

  .nav-item.active {
    color: #ff9f5a;
  }

  .nav-icon {
    font-size: 24px;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .time-inputs {
      flex-direction: column;
      gap: 16px;
    }

    .weekday-btn {
      width: 44px;
      height: 44px;
      font-size: 14px;
    }
  }

  /* Animation for form submission */
  @keyframes submitPulse {
    0% {
      transform: translateX(-50%) scale(1);
    }
    50% {
      transform: translateX(-50%) scale(0.95);
    }
    100% {
      transform: translateX(-50%) scale(1);
    }
  }

  .submit-btn.submitting {
    animation: submitPulse 0.3s ease-in-out;
    pointer-events: none;
  }

  /* Focus styles for accessibility */
  .weekday-btn:focus,
  .category-btn:focus,
  .submit-btn:focus {
    outline: 2px solid #ff9f5a;
    outline-offset: 2px;
  }

  /* Ripple effect container */
  .weekday-btn,
  .category-btn,
  .submit-btn {
    position: relative;
    overflow: hidden;
  }

  .ripple {
    position: absolute;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.5);
    transform: scale(0);
    animation: ripple-animation 0.6s ease-out;
    pointer-events: none;
  }

  @keyframes ripple-animation {
    to {
      transform: scale(4);
      opacity: 0;
    }
  }

  /* Form validation styles */
  .form-input:invalid,
  .time-input:invalid {
    border-color: #ff6b6b;
  }

  .form-input:valid,
  .time-input:valid {
    border-color: #e0e0e0;
  }

  /* Loading state */
  .submit-btn.loading::after {
    content: "";
    position: absolute;
    width: 16px;
    height: 16px;
    top: 50%;
    left: 50%;
    margin-left: -8px;
    margin-top: -8px;
    border: 2px solid #fff;
    border-radius: 50%;
    border-top-color: transparent;
    animation: spinner 0.6s linear infinite;
  }

  @keyframes spinner {
    to {
      transform: rotate(360deg);
    }
  }

  .submit-btn.loading {
    color: transparent;
    pointer-events: none;
  }

  /* Smooth transitions */
  * {
    -webkit-tap-highlight-color: transparent;
  }

  button {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
  }

  /* Placeholder animation */
  @keyframes placeholder-shimmer {
    0% {
      opacity: 1;
    }
    50% {
      opacity: 0.5;
    }
    100% {
      opacity: 1;
    }
  }

  .form-input:placeholder-shown,
  .memo-textarea:placeholder-shown {
    animation: placeholder-shimmer 2s ease-in-out infinite;
  }
</style>
{%block content %}
<div class="header">
  <h1>Âõ∫ÂÆö„Çø„Çπ„ÇØÁôªÈå≤</h1>
  <div class="tab-container">
    <button class="tab">„Çø„Çπ„ÇØÁôªÈå≤</button>
    <button class="tab active">Âõ∫ÂÆö„Çø„Çπ„ÇØÁôªÈå≤</button>
  </div>
</div>

<div class="form-container">
  <form
    id="taskForm"
    method="POST"
    action="{{ url_for('schedule.schedule_form') }}"
  >
    <div class="form-section">
      <div class="form-label">
        <span>„Çø„Çπ„ÇØÂêç</span>
        <a href="#" class="template-link">Âõ∫ÂÆö„Çø„Çπ„ÇØ‰∏ÄË¶ß ‚ò∞</a>
      </div>
      <input
        type="text"
        name="title"
        class="form-input"
        placeholder="‰Ωï„Çí„Åô„ÇãÔºü"
        value="{{ task.title if task else '' }}"
        required
      />
    </div>

    <div class="form-section">
      <div class="time-inputs">
        <div class="time-input-wrapper">
          <span class="time-label">ÈñãÂßãÊôÇÈñì</span>
          <input
            type="time"
            name="start_time"
            class="time-input"
            value="{{ task.start_time if task else '09:10' }}"
            required
          />
          <span class="time-icon">üïê</span>
        </div>
        <div class="time-input-wrapper">
          <span class="time-label">ÁµÇ‰∫ÜÊôÇÈñì</span>
          <input
            type="time"
            name="end_time"
            class="time-input"
            value="{{ task.end_time if task else '09:50' }}"
            required
          />
          <span class="time-icon">üïê</span>
        </div>
      </div>
    </div>

    <div class="form-section">
      <div class="form-label">Áπ∞„ÇäËøî„ÅôÊõúÊó•</div>
      <div class="weekday-selector">
        {% set weekdays = ['Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü', 'Êó•'] %} {% set
        default_active = ['Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë'] %} {% for day in
        weekdays %}
        <button
          type="button"
          class="weekday-btn {% if (task and day in task.active_days) or (not task and day in default_active) %}active{% endif %}"
          data-day="{{ day }}"
          onclick="toggleWeekday(this)"
        >
          {{ day }}
        </button>
        {% endfor %}
      </div>
      <input type="hidden" name="active_days" id="activeDays" value="" />
    </div>

    <div class="form-section">
      <div class="form-label">„Ç´„ÉÜ„Ç¥„É™„Éº</div>
      <div class="category-selector">
        {% set categories = ['„Çª„É´„Éï„Ç±„Ç¢', '„Çª„É´„Éï„Ç±„Ç¢', '„Çª„É´„Éï„Ç±„Ç¢'] %} {% for
        category in categories %}
        <button
          type="button"
          class="category-btn {% if loop.first %}active{% endif %}"
          onclick="selectCategory(this)"
        >
          {{ category }}
        </button>
        {% endfor %}
      </div>
      <input type="hidden" name="category" id="category" value="„Çª„É´„Éï„Ç±„Ç¢" />
    </div>

    <div class="form-section">
      <div class="form-label">„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥</div>
      <textarea
        name="memo"
        class="memo-textarea"
        placeholder="„Çø„Çπ„ÇØ„ÅÆ„É°„É¢„ÇÑÊâãÈ†Ü„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ"
      >
{{ task.memo if task else '' }}</textarea
      >
    </div>

    <div class="info-box">
      <span class="info-icon">„Åµ„Çè„Åô„Åë</span>
      <p class="info-text">
        Âõ∫ÂÆö„Çø„Çπ„ÇØ„ÅØÊØéÈÄ±Ê±∫„Åæ„Å£„ÅüÊôÇÈñì„Å´„Ç´„É¨„É≥„ÉÄ„Éº„Å´ËøΩÂä†„Åï„Çå„Çã„Çà
      </p>
    </div>
  </form>
</div>

<button type="submit" form="taskForm" class="submit-btn">ÁôªÈå≤</button>
<script>
  // Fixed Task Registration Form - Complete JavaScript

  // Initialize form on page load
  document.addEventListener("DOMContentLoaded", function () {
    initializeForm();
    setupFormValidation();
    setupTimeInputs();
    setupCategorySelection();
    setupWeekdaySelection();
    addRippleEffects();
    setupFormSubmission();
  });

  // Initialize form with default values
  function initializeForm() {
    // Set initial active days value
    updateActiveDaysInput();

    // Set initial category value
    const activeCategory = document.querySelector(".category-btn.active");
    if (activeCategory) {
      document.getElementById("category").value =
        activeCategory.textContent.trim();
    }

    // Auto-focus on task name input
    const taskNameInput = document.querySelector('.form-input[name="title"]');
    if (taskNameInput && !taskNameInput.value) {
      setTimeout(() => {
        taskNameInput.focus();
      }, 300);
    }
  }

  // Toggle weekday selection
  function toggleWeekday(btn) {
    btn.classList.toggle("active");

    // Add haptic feedback if available
    if (navigator.vibrate) {
      navigator.vibrate(10);
    }

    // Update hidden input
    updateActiveDaysInput();

    // Add ripple effect
    addRipple(btn, event);
  }

  // Update active days hidden input
  function updateActiveDaysInput() {
    const actives = document.querySelectorAll(".weekday-btn.active");
    const days = Array.from(actives)
      .map((b) => b.dataset.day)
      .join("");
    document.getElementById("activeDays").value = days;
  }

  // Select category
  function selectCategory(btn) {
    // Remove active class from all category buttons
    const categoryBtns = document.querySelectorAll(".category-btn");
    categoryBtns.forEach((b) => b.classList.remove("active"));

    // Add active class to clicked button
    btn.classList.add("active");

    // Update hidden input
    document.getElementById("category").value = btn.textContent.trim();

    // Add haptic feedback if available
    if (navigator.vibrate) {
      navigator.vibrate(10);
    }

    // Add ripple effect
    addRipple(btn, event);
  }

  // Setup form validation
  function setupFormValidation() {
    const form = document.getElementById("taskForm");
    const inputs = form.querySelectorAll("input[required], textarea[required]");

    inputs.forEach((input) => {
      input.addEventListener("blur", function () {
        validateField(this);
      });

      input.addEventListener("input", function () {
        if (this.classList.contains("error")) {
          validateField(this);
        }
      });
    });
  }

  // Validate individual field
  function validateField(field) {
    if (!field.value.trim() && field.hasAttribute("required")) {
      field.classList.add("error");
      return false;
    } else {
      field.classList.remove("error");
      return true;
    }
  }

  // Setup time inputs
  function setupTimeInputs() {
    const timeInputs = document.querySelectorAll(".time-input");

    timeInputs.forEach((input) => {
      // Format time on change
      input.addEventListener("change", function () {
        formatTimeInput(this);
      });

      // Add focus animation
      input.addEventListener("focus", function () {
        this.parentElement.style.transform = "scale(1.02)";
        this.parentElement.style.transition = "transform 0.2s";
      });

      input.addEventListener("blur", function () {
        this.parentElement.style.transform = "scale(1)";
      });
    });

    // Validate end time is after start time
    const startTime = document.querySelector('input[name="start_time"]');
    const endTime = document.querySelector('input[name="end_time"]');

    if (startTime && endTime) {
      const validateTimes = () => {
        if (startTime.value && endTime.value) {
          const start = timeToMinutes(startTime.value);
          const end = timeToMinutes(endTime.value);

          if (end <= start) {
            endTime.setCustomValidity("ÁµÇ‰∫ÜÊôÇÈñì„ÅØÈñãÂßãÊôÇÈñì„Çà„ÇäÂæå„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ");
            showToast("ÁµÇ‰∫ÜÊôÇÈñì„ÅØÈñãÂßãÊôÇÈñì„Çà„ÇäÂæå„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ", "warning");
          } else {
            endTime.setCustomValidity("");
          }
        }
      };

      startTime.addEventListener("change", validateTimes);
      endTime.addEventListener("change", validateTimes);
    }
  }

  // Convert time to minutes for comparison
  function timeToMinutes(time) {
    const [hours, minutes] = time.split(":").map(Number);
    return hours * 60 + minutes;
  }

  // Format time input
  function formatTimeInput(input) {
    let value = input.value;
    if (value) {
      // Ensure proper format
      const [hours, minutes] = value.split(":");
      const formattedHours = hours.padStart(2, "0");
      const formattedMinutes = minutes.padStart(2, "0");
      input.value = `${formattedHours}:${formattedMinutes}`;
    }
  }

  // Setup category selection
  function setupCategorySelection() {
    const categoryBtns = document.querySelectorAll(".category-btn");

    categoryBtns.forEach((btn) => {
      btn.addEventListener("click", function (e) {
        e.preventDefault();
        selectCategory(this);
      });
    });
  }

  // Setup weekday selection
  function setupWeekdaySelection() {
    const weekdayBtns = document.querySelectorAll(".weekday-btn");

    weekdayBtns.forEach((btn) => {
      btn.addEventListener("click", function (e) {
        e.preventDefault();
        toggleWeekday(this);
      });
    });
  }

  // Add ripple effects to buttons
  function addRippleEffects() {
    const buttons = document.querySelectorAll(
      ".weekday-btn, .category-btn, .submit-btn",
    );

    buttons.forEach((button) => {
      button.addEventListener("click", function (e) {
        addRipple(this, e);
      });
    });
  }

  // Add ripple effect to element
  function addRipple(element, event) {
    const ripple = document.createElement("span");
    ripple.classList.add("ripple");

    const rect = element.getBoundingClientRect();
    const size = Math.max(rect.width, rect.height);
    const x = event.clientX - rect.left - size / 2;
    const y = event.clientY - rect.top - size / 2;

    ripple.style.width = ripple.style.height = size + "px";
    ripple.style.left = x + "px";
    ripple.style.top = y + "px";

    // Remove existing ripples
    const existingRipples = element.querySelectorAll(".ripple");
    existingRipples.forEach((r) => r.remove());

    element.appendChild(ripple);

    setTimeout(() => ripple.remove(), 600);
  }

  // Setup form submission
  function setupFormSubmission() {
    const form = document.getElementById("taskForm");
    const submitBtn = document.querySelector(".submit-btn");

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      // Validate form
      if (!validateForm()) {
        showToast("ÂÖ•ÂäõÂÜÖÂÆπ„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ", "error");
        return;
      }

      // Show loading state
      submitBtn.classList.add("loading");
      submitBtn.disabled = true;

      // Haptic feedback
      if (navigator.vibrate) {
        navigator.vibrate([10, 50, 10]);
      }

      // Simulate form submission (remove this in production)
      setTimeout(() => {
        // Submit the form
        form.submit();

        // Or handle with AJAX:
        // submitFormAjax(form);
      }, 500);
    });
  }

  // Validate entire form
  function validateForm() {
    const form = document.getElementById("taskForm");
    const requiredInputs = form.querySelectorAll(
      "input[required], textarea[required]",
    );
    let isValid = true;

    // Check task name
    const taskName = form.querySelector('input[name="title"]');
    if (!taskName.value.trim()) {
      isValid = false;
      taskName.classList.add("error");
    }

    // Check times
    const startTime = form.querySelector('input[name="start_time"]');
    const endTime = form.querySelector('input[name="end_time"]');
    if (!startTime.value || !endTime.value) {
      isValid = false;
    }

    // Check at least one weekday selected
    const activeDays = document.getElementById("activeDays").value;
    if (!activeDays) {
      showToast("Áπ∞„ÇäËøî„ÅôÊõúÊó•„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ", "warning");
      isValid = false;
    }

    // Check category selected
    const category = document.getElementById("category").value;
    if (!category) {
      showToast("„Ç´„ÉÜ„Ç¥„É™„Éº„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ", "warning");
      isValid = false;
    }

    return isValid;
  }

  // Submit form via AJAX (optional)
  function submitFormAjax(form) {
    const formData = new FormData(form);

    fetch(form.action, {
      method: "POST",
      body: formData,
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.success) {
          showToast("Âõ∫ÂÆö„Çø„Çπ„ÇØ„ÇíÁôªÈå≤„Åó„Åæ„Åó„Åü", "success");
          setTimeout(() => {
            window.location.href = data.redirect || "/schedule/list";
          }, 1000);
        } else {
          showToast(data.message || "„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü", "error");
          document.querySelector(".submit-btn").classList.remove("loading");
          document.querySelector(".submit-btn").disabled = false;
        }
      })
      .catch((error) => {
        console.error("Error:", error);
        showToast("„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü", "error");
        document.querySelector(".submit-btn").classList.remove("loading");
        document.querySelector(".submit-btn").disabled = false;
      });
  }

  // Show toast notification
  function showToast(message, type = "info") {
    // Remove existing toasts
    const existingToasts = document.querySelectorAll(".toast");
    existingToasts.forEach((toast) => toast.remove());

    const toast = document.createElement("div");
    toast.className = `toast toast-${type}`;
    toast.textContent = message;

    const styles = {
      position: "fixed",
      top: "80px",
      left: "50%",
      transform: "translateX(-50%)",
      padding: "12px 24px",
      borderRadius: "24px",
      color: "#fff",
      fontSize: "14px",
      fontWeight: "500",
      zIndex: "10000",
      animation: "slideDown 0.3s ease-out",
      boxShadow: "0 4px 12px rgba(0, 0, 0, 0.15)",
    };

    Object.assign(toast.style, styles);

    // Set background color based on type
    const colors = {
      success: "#4CAF50",
      error: "#ff6b6b",
      warning: "#FF9F5A",
      info: "#2196F3",
    };
    toast.style.background = colors[type] || colors.info;

    document.body.appendChild(toast);

    // Add animation
    const keyframes = `
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }
  `;

    const styleSheet = document.createElement("style");
    styleSheet.textContent = keyframes;
    document.head.appendChild(styleSheet);

    // Auto remove after 3 seconds
    setTimeout(() => {
      toast.style.animation = "slideUp 0.3s ease-out";
      setTimeout(() => toast.remove(), 300);
    }, 3000);
  }

  // Auto-save draft (optional feature)
  function setupAutoSave() {
    const form = document.getElementById("taskForm");
    const inputs = form.querySelectorAll("input, textarea");

    inputs.forEach((input) => {
      input.addEventListener(
        "input",
        debounce(function () {
          saveDraft();
        }, 1000),
      );
    });
  }

  // Save form data to localStorage
  function saveDraft() {
    const form = document.getElementById("taskForm");
    const formData = new FormData(form);
    const data = {};

    for (let [key, value] of formData.entries()) {
      data[key] = value;
    }

    data.activeDays = document.getElementById("activeDays").value;
    data.category = document.getElementById("category").value;

    localStorage.setItem("taskDraft", JSON.stringify(data));
    console.log("Draft saved");
  }

  // Load draft from localStorage
  function loadDraft() {
    const draft = localStorage.getItem("taskDraft");
    if (draft) {
      const data = JSON.parse(draft);

      // Fill form with draft data
      Object.keys(data).forEach((key) => {
        const input = document.querySelector(`[name="${key}"]`);
        if (input) {
          input.value = data[key];
        }
      });

      // Restore weekday selections
      if (data.activeDays) {
        const days = data.activeDays.split("");
        const weekdayBtns = document.querySelectorAll(".weekday-btn");
        weekdayBtns.forEach((btn) => {
          if (days.includes(btn.dataset.day)) {
            btn.classList.add("active");
          } else {
            btn.classList.remove("active");
          }
        });
      }

      // Restore category selection
      if (data.category) {
        const categoryBtns = document.querySelectorAll(".category-btn");
        categoryBtns.forEach((btn) => {
          if (btn.textContent.trim() === data.category) {
            btn.classList.add("active");
          } else {
            btn.classList.remove("active");
          }
        });
      }
    }
  }

  // Debounce function
  function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  }

  // Clear draft after successful submission
  function clearDraft() {
    localStorage.removeItem("taskDraft");
  }

  // Character counter for memo textarea (optional)
  function setupCharacterCounter() {
    const textarea = document.querySelector(".memo-textarea");
    if (textarea) {
      const counter = document.createElement("div");
      counter.className = "character-counter";
      counter.style.cssText =
        "text-align: right; color: #999; font-size: 12px; margin-top: 4px;";

      textarea.parentElement.appendChild(counter);

      const updateCounter = () => {
        const length = textarea.value.length;
        const maxLength = textarea.getAttribute("maxlength") || 500;
        counter.textContent = `${length} / ${maxLength}`;

        if (length > maxLength * 0.9) {
          counter.style.color = "#ff6b6b";
        } else {
          counter.style.color = "#999";
        }
      };

      textarea.addEventListener("input", updateCounter);
      updateCounter();
    }
  }
</script>

{% endblock %}
